# Android AntiForensic Tools
**Прочитайте хотя бы раздел "Установка" перед использованием приложения!**

## Описание приложения

Android AntiForensic Tools это бесплатное приложение с открытым исходным кодом, созданное, чтобы защитить ваши данные от могущественного злоумышленника, способного оказать на вас давление и заставить разблокировать устройство. Оно позволяет стереть данные устройства, профили пользователей или личные файлы при вводе фейкового пароля, подключении USB-устройства, многократном нажатии на кнопку питания или многократном вводе неправильного пароля. Приложение предлагает дополнительные опции для защиты вашего устройства от продвинутых злоумышленников: оно может удалить себя, запустить [TRIM](https://en.wikipedia.org/wiki/Trim_%28computing%29) после удаления данных, чтобы предотвратить восстановление удаленных данных, отключить логи перед удалением данных, чтобы не оставить следов своих действий, запретить загрузку в безопасный режим и т.д.
## Возможности и ограничения
На создание этого приложения меня вдохновило приложение [Wasted](https://github.com/x13a/Wasted) от x13a. Оно позволяет сбросить устройство до заводских настроек при вводе фейкового пароля, подключении USB или при иных триггерах. Это приложение - большое достижение для антифоренсики на Android-устройствах, и в некоторых ситуациях оно может быть полезно, но у него есть недостатки:                     
* Сброс данных устройства очевиден для противника. Это может его разозлить и привести к непредвиденным последствиям для пользователя.
* Приложение не обновлялось уже 2 года.
* Защита, предоставляемая приложением, может быть обойдена с помощью загрузки устройства в безопасном режиме, в котором отключены все пользовательские приложения.
* Приложение удаляет все данные пользователя, в том числе и безобидные.
* Приложение [не работает](https://github.com/x13a/Wasted/issues/73) на Android 14 и выше. Для сброса устройства использовался метод [wipeData](https://developer.android.com/reference/android/app/admin/DevicePolicyManager#wipeData%28int,%20java.lang.CharSequence%29), который после выхода Android 14 нельзя  вызвать от имени главного пользователя, а значит нельзя осуществить и сброс устройства. Вместо wipeData для осуществления полного сброса на новых версиях Android нужно вызвать метод [wipeDevice](https://developer.android.com/reference/android/app/admin/DevicePolicyManager#wipeDevice%28int%29), но он доступен только приложению-владельцу устройства - а Wasted использует только права администора.

Моё приложение призвано исправить эти недостатки. Оно позволяет стереть все данные на новых версиях Android без root-прав с помощью Dhizuku, приложения для раздачи прав владельца устройства другим приложениям. Оно позволяет запретить загрузку в безопасном режиме с помощью Dhizuku или root. Но, что самое главное, оно позволяет удалять данные **относительно** незаметно. Вместо того, чтобы сбрасывать устройство, приложение позволяет удалить отдельный профиль пользователя или пользовательские файлы. После завершения всех операций приложение может удалить само себя.

К сожалению, у незаметности удаления данных есть ограничения, хотя удаление данных всё равно будет намного более незаметным, чем сброс устройства до заводских настроек. После удаления данных в разных местах системы (в логах, кэше, статистике и т.д.) остаётся множество свидетельств о том, что эти данные существовали. Стереть все эти следы практически невозможно, и продвинутый противник с полным доступом к устройству сможет их обнаружить. К счастью, некоторые из этих следов безобидны - вы можете выдумать всё что угодно об удалённом профиле Android. Однако некоторые следы позволяют установить, что вы стирали данные недавно с помощью этого приложения, что вызовет у противника куда больший интерес к тому, чтобы вытянуть из вас правду. Со следами такого рода я пытаюсь бороться. Приложение включает в себя некоторые дополнительные опции, которые позволят скрыть его существование на устройстве, следы ваших данных и  роль приложения в стирании данных с Вашего устройства. Тем не менее, изучение следов удалённых данных всё ещё далеко от завершения.

Ещё один недостаток приложения заключается в том, что наиболее продвинутые функции приложения, в том числе и удаление приложением самого себя, требуют рут-прав. Предоставление рут-прав обычно сопровождается разблокировкой загрузчика, хотя на некоторых девайсах можно [использовать рут-права с заблокированным загрузчиком](https://github.com/chenxiaolong/avbroot). Как рут-права, так и разблокированный загрузчик [делают](https://madaidans-insecurities.github.io/android.html) устройство более уязвимым к некоторым другим типам атак. Вместо рут-прав можно использовать права владельца приложения через Dhizuku, однако в таком случае система Android покажет нескрываемое уведомление, если приложение попытается самоуничтожиться, что делает опцию самоуничтожения практически бесполезной при использовании без рут прав. С помощью прав владельца устройства можно скрыть приложение из лаунчера и стереть его данные, к тому же приложение маскируется под другие приложения, но раскрыть присутствие приложения на устройстве в таком случае всё же будет возможно.

## Установка
В разделе "Releases" вы можете скачать 5 версий приложения. 2 из них можно установить как обычные APK-файлы, а 3 нужно устанавливать через ADB. Процесс установки через ADB будет описан ниже.
Версии, которые можно установить как обычные APK-пакеты, имеют недостаток - опция самоуничтожения в них несовместима с правами администратора, а права администратора необходимы для защиты от перебора паролей. Поэтому они называются "NOT_RECOMMENDED" и их установка не рекомендуется.

4 версии приложения замаскированы под другие приложения - [Island](https://github.com/oasisfeng/island) и [Shelter](https://gitea.angry.im/PeterCxy/Shelter). У них изменены имя пакета, иконка и название. Это необходимо для того, чтобы после удаления или самоуничтожения приложения для противника, изучающего систему, всё выглядело так, как будто вы удалили с устройства одно из этих приложений, а не Android AntiForensic Tools. Впрочем, не исключено, что даже переименование пакета не спасёт от обнаружения следов приложения продвинутым противником, требуются дальнейшие исследования для того, чтобы это проверить. Эти приложения были выбраны для маскировки, потому что они open source, и вы вряд ли будете использовать оба приложения одновременно. Если на вашем устройстве установлено одно из них, установите версию Android AntiForensic Tools, которая маскируется под другое.

В идеале я рекомендую перед установкой изменить имя пакета самостоятельно. При переименовании выберите имя пакета, используемое существующим приложением, которого нет на вашем устройстве. Процесс переименования пакета будет описан ниже.

### Описание версий приложения
* AFTools_original_ADB_NOT_RECOMMENDED - версия приложения с оригинальным именем пакета. **Не устанавливать без модификации имени пакета!**
* AFTools_island_NOT_RECOMMENDED - версия приложения, маскирующаяся под приложение Island. Может быть установлена без ADB, но **установка не рекомендуется.**
* AFTools_shelter_NOT_RECOMMENDED - версия приложения, маскирующаяся под приложение Shelter. Может быть установлена без ADB, но **установка не рекомендуется.**
* AFTools_island_ADB - версия приложения, маскирующаяся под приложение Island. **Требует ADB для установки!**
* AFTools_shelter_ADB - версия приложения, маскирующаяся под приложение Shelter. **Требует ADB для установки!**
### Установка через ADB
1. Скачайте на компьютер [SDK Platform tools](https://developer.android.com/tools/releases/platform-tools)
2. Распакуйте архив
3. Скачайте на компьютер версию приложения, требующую установку через ADB
4. На мобильном устройстве [разблокируйте настройки для разработчиков](https://developer.android.com/studio/debug/dev-options)
5. Откройте настройки для разработчиков и разрешите отладку через USB
6. Подключите устройство к компьютеру и разрешите отладку для этого устройства
7. Откройте командную строку и введите команду <путь к папке platform-tools>/adb[.exe] install -t <путь к apk файлу>.
### Изменение имени пакета приложения
#### Через Android Studio
1. Установите [Android Studio](https://developer.android.com/studio).
2. [Клонируйте проект](https://www.geeksforgeeks.org/how-to-clone-android-project-from-github-in-android-studio/) к себе с github.
3. Откройте меню File>Settings>Plugins и введите в поиск "Android package renamer"
4. Установите плагин. Если установка плагина запрещена в вашем регионе, используйте VPN.
5. Откройте опцию File>Rename package и введите новое имя пакета.
6. Перейдите в меню Build>Build Bundles/APKs>Build APKS и создайте apk файл.
#### Через Apktool
Пока что не удалось.
## Использование приложения
**Рекомендуется хотя бы раз протестировать работу приложения, в том числе и скорость удаления данных вместе с самоуничтожением.**

При запуске приложения вам понадобится ввести пароль. Этот пароль будет использоваться для разблокировки приложения, этот же пароль будет использоваться в качестве фейкового пароля, при вводе которого Ваши данные будут удалены. Постарайтесь сделать его сильным и похожим на реальный пароль от вашего устройства, чтобы вы могли сказать, что ввели неправильный пароль из-за опечатки.
### Сценарии использования
В зависимости от того, какую модель угроз вы считаете более реалистичной, я советую разные настройки для приложения:
* Если вы опасаетесь хакерских атак на ваше устройство или вы думаете, что вам не грозят последствия, если ваш противник обнаружит, что приложение удалило ваши данные, то не предоставляйте приложению рут-права. Настройте приложение на удаление всех данных устройства или на удаление части данных и скрытие из лаунчера устройства.
* Если же вы опасаетесь, что очевидное удаление данных с устройства или наличие следов приложения на устройстве вызовут у вас проблемы, дайте приложению рут-права. В этом случае я советую вам настроить удаление профиля вторичного пользователя и включить все возможные опции: остановить logd, запустить TRIM, удалить себя. Приложение остановит logd, удалит ваш профиль, запустит TRIM, чтобы сделать данные невосстановимыми, и, наконец, самоуничтожится. Подробное описание всех действий приложения будет приведено ниже. Полное самоуничтожение может занять несколько секунд, поэтому постарайтесь не сообщать правильный пароль противнику слишком быстро.
### Рекомендуемые настройки
Независимо от сценариев использования, я рекомендую следовать следующим рекомендациям:
* Активируйте все триггеры (ввод пароля, USB-соединение, брутфорс, нажатия на кнопку питания). Уничтожение данных начнется при активации одного из этих триггеров. Каждый из них защищает вас от разных типов атак. Подробное описание всех триггеров будет приведено ниже.
* Рекомендуется или стирать все данные на устройстве, или удалять пользовательский профиль. Удаление файлов невозможно до первой разблокировки устройства. В случае активации триггера до первой разблокировки устройства удаление файлов начнётся только после разблокировки, и только после этого могут быть запущены другие действия, такие как самоуничтожение приложения. Поэтому удаление файлов рекомендуется только если вы не хотите или не можете выдать приложению особые разрешения. Лучше храните свои секретные файлы в отдельном профиле и удаляйте его!
* Отключите безопасный режим загрузки или сделайте это приложение системным, если можете. Безопасный режим загрузки может быть использован для обхода защиты, предлагаемой этим приложением. Впрочем, отключение безопасного режима загрузки может вызвать подозрения.
* Если вы настроили это приложение на удаление данных в определённом пользовательском профиле, отключайте функцию переключения между пользователями, если она вам не нужна, поскольку в противном случае злоумышленник может воспользоваться выпадающим меню настроек, чтобы получить список ваших профилей на экране блокировки. Вы можете сделать это либо в настройках устройства, либо, если у вас есть нужные разрешения, в соответствующих пунктах настроек приложения.
* Если вы настроили это приложение для удаления данных в указанном профиле пользователя, установите это приложение и в этом профиле пользователя и настройте приложение на удаление всех данных при срабатывании всех триггеров.
* Убедитесь, что приложение работает и удаление данных с деинсталляцией приложения не занимают много времени. Вы можете использовать логи для проведения тестирования. Проверьте работу приложения перед использованием! Проверяйте работу приложения после обновлений! Если что-то не так, пожалуйста, создайте проблему на GitHub и покажите логи.

### Разрешения
После установки пароля вас перекинет в настройки. Здесь нужно будет выдать приложению определённые разрешения.
Для работы триггеров потребуется включить Accessibility service и выдать права администратора устройства.
Для остальных действий требуются либо права dhizuku (права  владельца устройства, которые можно получить через Dhizuku), либо root-права. Некоторые действия можно выполнить только с root-правами.
###  Использование с Dhizuku
Если Вы не можете выдать приложению root-права, то вы можете предоставить приложению права владельца устройства через [Dhizuku](https://github.com/iamr0s/Dhizuku). На данный момент Dhizuku из оригинального репозитория [не работает](https://github.com/iamr0s/Dhizuku/issues/85) до первой разблокировки устройства. Кроме того, если Вы установите выложенные там apk файлы и дадите Dhizuku права владельца устройства, то потом не сможете удалить приложение. Вы можете скачать apk-файлы Dhizuku из моего [форка](https://github.com/bakad3v/Dhizuku), там исправлены все ошибки и есть удаляемая версия приложения. Там же есть инструкция по установке приложения и по предоставлению ему прав владельца устройства.
### Триггеры
После выдачи разрешений Вы можете настроить триггеры.  
На данный момент приложение поддерживает четыре триггера:
* Run on duress password. Уничтожение данных начнётся при вводе фейкового пароля (совпадает с паролем приложения). Для работы требуется accessibility service.
* Prevent bruteforce. Уничтожение данных начнётся при вводе заданного количества неверных паролей (по умолчанию - 5). Для работы требуются права администратора.
* Run on USB connection. Уничтожение данных начнётся при подключении USB устройства. Зарядка от компьютера тоже считается. Для работы требуется accessibility service. Также можно выбрать опцию "Reboot on USB connection", в таком случае устройство просто перезагрузится при подключении USB и перейдёт в режим BFU. **Отключайте эту опцию всегда, когда хотите подключить устройство через USB.**
* Run on button clicks. Уничтожение данных начнётся при заданном количестве нажатий на кнопку питания (по умолчанию - 5), идущих подряд. Клики считаются идущими подряд, если между ними прошло меньше заданного количества времени (по умолчанию - 1000 мс). За нажатие засчитывается любое включение/выключение экрана, так что будьте осторожны!
### Действия
После настройки триггеров вы можете выбрать, какие действия будет выполнять ваше приложение.
* Run TRIM. После удаления данных будет запущена операция TRIM, которая пометит блоки с удалёнными данными, как свободные. Может затруднить восстановление удалённых данных, **рекомендуется, особенно если вы удаляете файлы**. Требуется root.
* Wipe data. Стирает все данные, если вызвана с основного пользователя, иначе удаляет данные пользователя. Подойдёт любой суперпользователь (админ, dhizuku или root), но если у вас Android 14 и больше и вы хотите стереть все данные, то требуются права dhizuku или root-права. Помните, что удаление всех данных будет очевидно для противника.
* Remove itself. После удаления данных приложение удалит себя. Требуются root-права или права dhizuku, однако при использовании с правами dhizuku устройства Android, скорее всего, покажет уведомление об удалении приложения, сделав это очевидным для противника. **Настоятельно рекомендуется включить и использовать с root-правами**.
* Clear itself. Приложение очистит свои данные и разрешения после завершения удаления ваших данных. Менее надёжная альтернатива самоуничтожению для использования с правами  dhizuku. Если используется с правами dhizuku, то несовместимо с правами администратора. Требуются права dhizuku или root, Android 9 и выше.
* Clear data. Приложение очистит свои данные после завершения удаления ваших данных. Не требует разрешений. После вызова этой функции приложение может скрыть себя, если выбрана соответствующая опция.
* Hide itself. Приложение скроет себя после завершения удаления всех данных. Ещё одна менее надёжная альтернатива самоуничтожению для использования с правами  dhizuku. **Если эта опция будет вызвана с правами dhizuku, то приложение будет скрыто только из лаунчера, но оно будет видно в настройках!**. Если используется с правами dhizuku, то несовместимо с правами администратора. Требуются права dhizuku или root.
* Stop logd on start. Приложение остановит сервис логирования logd до удаления данных. Благодаря этому в логах не будут записаны действия, связанные с удалением данных. Требуется root.
* Stop logd on boot. Приложение остановит сервис логирования logd при загрузке устройства (точнее, когда включится accessibility service). Требуется root. **Настоятельно рекомендуется включить**
### Удаление данных
Наконец, вы можете выбрать данные, которые будут удалены при активации триггеров.

На данный момент вы можете выбрать профили и файлы для удаления. **После выбора кандидатов на удаление не забудьте нажать на кнопку "разрешить удаление" (зелёный треугольник) в верхней части экрана, чтобы удаление файлов или профилей было активировано.**

Для удаления профилей требуются права dhizuku или root-права. Многопользовательский режим может быть отключён в вашей прошивке - перейдите в раздел "дополнительные настройки", чтобы узнать, как это исправить.

Удаление файлов не требует особых разрешений.
### Запуск root-комманд
Вы можете запустить свои root комманды после удаления профилей и до запуска TRIM/самоуничтожения приложения - просто введите команды на экране "Root command settings". 
### Дополнительные настройки
* Safe boot status. Вы можете запретить или разрешить загрузку в безопасном режиме. Безопасный режим может быть использован для обхода защиты, предоставляемой приложением, так что **его рекомендуется запретить.** С другой стороны, отключённый безопасный режим сам по себе может вызвать подозрения, так что более элегантным решением было бы преобразовать приложение в системное, но его работа при таких условиях не протестирована. Требуются права dhizuku или root.
* Multiuser UI. Если на вашем устройстве отключены настройки профилей, можно включить их с помощью этой опции. Требуются root-права.
* User switcher UI. Можно включить или отключить графический интерфейс для переключения между пользователями. Эта настройка включена на случай, если в вашей прошивке Android она будет скрыта. Требуются root-права и Android 10 или выше.
* Switch user permission. Настройка для тех же целей для Android 9. Рекомендуется использовать только если настройка выше не сработала.  Требуются root-права или права dhizuku и Android 9 или выше.
* Maximum number of users. Можно изменить максимальное число профилей. Требуются root-права.
## Благодарности
x13a, разработчик Wasted

iamr0s, разработчик Dhizuku

BinTianqi, разработчик [Owndroid](https://github.com/BinTianqi/OwnDroid) - он написал код для работы с Dhizuku в своём приложении.

## Поддержать разработчика
Вы можете поддержать меня в криптовалюте.
XMR: 88Z5fsVK6FP4oVNjo2BrHydAEa5Y1gTPi5d7BN68sjVDZ9dTn8wPb89WmUxrxf3T37bRGSR5dekkU9aQ7j8ErWcBJ2GZojC
